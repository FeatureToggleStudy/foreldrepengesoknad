version: '3'
services:
    webapp:
        image: node
        build: ./
        container_name: foreldrepengesoknad-test-container
        restart: always
        ports:
            - "8080:8080"
        environment:
            - APPRES_CMS_URL=http://appres.nav.no
            - FORELDREPENGESOKNAD_API_URL=http://localhost:8888/rest
            - LOGINSERVICE_URL=http://localhost:8888/local/cookie
            - FP_UTTAK_SERVICE_URL=https://fp-uttak-service.nav.no

    cypress-tests:
        image: cypress
        build: ./cypress-tests
        container_name: cypress
        depends_on:
            - webapp
        # note: inside e2e container, the network allows accessing
        # "web" host under name "web"
        # so "curl http://web" would return whatever the webserver
        # in the "web" container is cooking
        # see https://docs.docker.com/compose/networking/
        environment:
            - CYPRESS_baseUrl=http://webapp:8080
        command: npx cypress run
        # mount the host directory e2e/cypress and the file e2e/cypress.json as
        # volumes within the container
        # this means that:
        #  1. anything that Cypress writes to these folders (e.g., screenshots,
        #     videos) appears also on the Docker host's filesystem
        #  2. any change that the developer applies to Cypress files on the host
        #     machine immediately takes effect within the e2e container (no docker
        #     rebuild required).
        volumes:
            - ./cypress-tests/cypress:/app/cypress
            - .//cypress.json:/app/cypress.json
